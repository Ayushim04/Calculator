<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Designer Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    * {
      font-family: 'Space Grotesk', sans-serif;
    }
    
    .calc-btn {
      transition: all 0.15s ease;
      position: relative;
      overflow: hidden;
    }
    
    .calc-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.4s ease, height 0.4s ease;
    }
    
    .calc-btn:active::before {
      width: 200%;
      height: 200%;
    }
    
    .calc-btn:hover {
      transform: translateY(-2px);
    }
    
    .calc-btn:active {
      transform: translateY(0);
    }
    
    .display-text {
      animation: slideIn 0.1s ease;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0.7;
        transform: translateX(10px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    .glass-effect {
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    }
    
    .accent-gradient {
      background: linear-gradient(135deg, #e94560 0%, #ff6b6b 100%);
    }
    
    .number-btn {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .number-btn:hover {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.2);
    }
    
    .operator-btn {
      background: rgba(233, 69, 96, 0.2);
      border: 1px solid rgba(233, 69, 96, 0.3);
    }
    
    .operator-btn:hover {
      background: rgba(233, 69, 96, 0.35);
      border-color: rgba(233, 69, 96, 0.5);
    }
    
    .function-btn {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    .function-btn:hover {
      background: rgba(255, 255, 255, 0.12);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full gradient-bg flex items-center justify-center p-4 overflow-auto">
  <main class="w-full max-w-sm"><!-- Calculator Container -->
   <div class="glass-effect bg-white/5 rounded-3xl p-6 shadow-2xl border border-white/10"><!-- Title -->
    <h1 id="calc-title" class="text-white/60 text-sm font-medium text-center mb-4 tracking-widest uppercase">Calculator</h1><!-- Display -->
    <div class="bg-black/30 rounded-2xl p-5 mb-5 border border-white/5">
     <div id="expression" class="text-white/50 text-right text-sm h-6 overflow-hidden font-medium tracking-wide"></div>
     <div id="display" class="text-white text-right text-5xl font-bold tracking-tight display-text overflow-hidden">
      0
     </div>
    </div><!-- Button Grid -->
    <div class="grid grid-cols-4 gap-3"><!-- Row 1 --> <button onclick="clearAll()" class="calc-btn function-btn text-white/80 text-lg font-semibold rounded-2xl h-16 hover:text-white">AC</button> <button onclick="toggleSign()" class="calc-btn function-btn text-white/80 text-lg font-semibold rounded-2xl h-16 hover:text-white">±</button> <button onclick="percentage()" class="calc-btn function-btn text-white/80 text-lg font-semibold rounded-2xl h-16 hover:text-white">%</button> <button onclick="setOperator('/')" class="calc-btn operator-btn text-[#e94560] text-2xl font-bold rounded-2xl h-16">÷</button> <!-- Row 2 --> <button onclick="appendNumber('7')" class="calc-btn number-btn text-white text-2xl font-semibold rounded-2xl h-16">7</button> <button onclick="appendNumber('8')" class="calc-btn number-btn text-white text-2xl font-semibold rounded-2xl h-16">8</button> <button onclick="appendNumber('9')" class="calc-btn number-btn text-white text-2xl font-semibold rounded-2xl h-16">9</button> <button onclick="setOperator('*')" class="calc-btn operator-btn text-[#e94560] text-2xl font-bold rounded-2xl h-16">×</button> <!-- Row 3 --> <button onclick="appendNumber('4')" class="calc-btn number-btn text-white text-2xl font-semibold rounded-2xl h-16">4</button> <button onclick="appendNumber('5')" class="calc-btn number-btn text-white text-2xl font-semibold rounded-2xl h-16">5</button> <button onclick="appendNumber('6')" class="calc-btn number-btn text-white text-2xl font-semibold rounded-2xl h-16">6</button> <button onclick="setOperator('-')" class="calc-btn operator-btn text-[#e94560] text-2xl font-bold rounded-2xl h-16">−</button> <!-- Row 4 --> <button onclick="appendNumber('1')" class="calc-btn number-btn text-white text-2xl font-semibold rounded-2xl h-16">1</button> <button onclick="appendNumber('2')" class="calc-btn number-btn text-white text-2xl font-semibold rounded-2xl h-16">2</button> <button onclick="appendNumber('3')" class="calc-btn number-btn text-white text-2xl font-semibold rounded-2xl h-16">3</button> <button onclick="setOperator('+')" class="calc-btn operator-btn text-[#e94560] text-2xl font-bold rounded-2xl h-16">+</button> <!-- Row 5 --> <button onclick="appendNumber('0')" class="calc-btn number-btn text-white text-2xl font-semibold rounded-2xl h-16 col-span-2">0</button> <button onclick="appendDecimal()" class="calc-btn number-btn text-white text-2xl font-semibold rounded-2xl h-16">.</button> <button onclick="calculate()" class="calc-btn accent-gradient text-white text-2xl font-bold rounded-2xl h-16 shadow-lg shadow-[#e94560]/30">=</button>
    </div>
   </div><!-- Decorative Elements -->
   <div class="flex justify-center gap-2 mt-6">
    <div class="w-2 h-2 rounded-full bg-[#e94560]/60"></div>
    <div class="w-2 h-2 rounded-full bg-white/20"></div>
    <div class="w-2 h-2 rounded-full bg-white/20"></div>
   </div>
  </main>
  <script>
    // Calculator State
    let currentValue = '0';
    let previousValue = '';
    let operator = null;
    let waitingForOperand = false;
    let expression = '';

    // Default configuration
    const defaultConfig = {
      calculator_title: 'Calculator',
      background_color: '#1a1a2e',
      surface_color: '#0f3460',
      text_color: '#ffffff',
      primary_action_color: '#e94560',
      secondary_action_color: '#ff6b6b'
    };

    // Update display
    function updateDisplay() {
      const displayEl = document.getElementById('display');
      const expressionEl = document.getElementById('expression');
      
      // Format number for display
      let displayValue = currentValue;
      if (displayValue.length > 12) {
        const num = parseFloat(displayValue);
        if (!isNaN(num)) {
          displayValue = num.toExponential(6);
        }
      }
      
      displayEl.textContent = displayValue;
      displayEl.classList.remove('display-text');
      void displayEl.offsetWidth; // Trigger reflow
      displayEl.classList.add('display-text');
      
      expressionEl.textContent = expression;
    }

    // Append number to display
    function appendNumber(num) {
      if (waitingForOperand) {
        currentValue = num;
        waitingForOperand = false;
      } else {
        if (currentValue === '0' && num !== '0') {
          currentValue = num;
        } else if (currentValue !== '0') {
          if (currentValue.replace(/[^0-9]/g, '').length < 15) {
            currentValue += num;
          }
        }
      }
      updateDisplay();
    }

    // Append decimal point
    function appendDecimal() {
      if (waitingForOperand) {
        currentValue = '0.';
        waitingForOperand = false;
        updateDisplay();
        return;
      }
      
      if (!currentValue.includes('.')) {
        currentValue += '.';
        updateDisplay();
      }
    }

    // Set operator
    function setOperator(op) {
      const inputValue = parseFloat(currentValue);
      
      if (operator && !waitingForOperand) {
        const result = performCalculation();
        currentValue = String(result);
        previousValue = currentValue;
      } else {
        previousValue = currentValue;
      }
      
      operator = op;
      waitingForOperand = true;
      
      // Update expression display
      const opSymbol = op === '*' ? '×' : op === '/' ? '÷' : op === '-' ? '−' : '+';
      expression = `${formatNumber(previousValue)} ${opSymbol}`;
      updateDisplay();
    }

    // Format number for expression
    function formatNumber(num) {
      const parsed = parseFloat(num);
      if (isNaN(parsed)) return num;
      if (Number.isInteger(parsed)) return parsed.toString();
      return parsed.toString();
    }

    // Perform calculation
    function performCalculation() {
      const prev = parseFloat(previousValue);
      const current = parseFloat(currentValue);
      
      if (isNaN(prev) || isNaN(current)) return current;
      
      let result;
      switch (operator) {
        case '+':
          result = prev + current;
          break;
        case '-':
          result = prev - current;
          break;
        case '*':
          result = prev * current;
          break;
        case '/':
          result = current === 0 ? 'Error' : prev / current;
          break;
        default:
          return current;
      }
      
      if (typeof result === 'number') {
        // Handle floating point precision
        result = Math.round(result * 1000000000000) / 1000000000000;
      }
      
      return result;
    }

    // Calculate result
    function calculate() {
      if (!operator || waitingForOperand) return;
      
      const opSymbol = operator === '*' ? '×' : operator === '/' ? '÷' : operator === '-' ? '−' : '+';
      expression = `${formatNumber(previousValue)} ${opSymbol} ${formatNumber(currentValue)} =`;
      
      const result = performCalculation();
      currentValue = String(result);
      operator = null;
      previousValue = '';
      waitingForOperand = true;
      
      updateDisplay();
    }

    // Clear all
    function clearAll() {
      currentValue = '0';
      previousValue = '';
      operator = null;
      waitingForOperand = false;
      expression = '';
      updateDisplay();
    }

    // Toggle sign
    function toggleSign() {
      if (currentValue === '0' || currentValue === 'Error') return;
      
      if (currentValue.startsWith('-')) {
        currentValue = currentValue.slice(1);
      } else {
        currentValue = '-' + currentValue;
      }
      updateDisplay();
    }

    // Percentage
    function percentage() {
      const value = parseFloat(currentValue);
      if (isNaN(value)) return;
      
      currentValue = String(value / 100);
      updateDisplay();
    }

    // Keyboard support
    document.addEventListener('keydown', (e) => {
      if (e.key >= '0' && e.key <= '9') {
        appendNumber(e.key);
      } else if (e.key === '.') {
        appendDecimal();
      } else if (e.key === '+' || e.key === '-' || e.key === '*' || e.key === '/') {
        setOperator(e.key);
      } else if (e.key === 'Enter' || e.key === '=') {
        e.preventDefault();
        calculate();
      } else if (e.key === 'Escape' || e.key === 'c' || e.key === 'C') {
        clearAll();
      } else if (e.key === 'Backspace') {
        if (currentValue.length > 1) {
          currentValue = currentValue.slice(0, -1);
        } else {
          currentValue = '0';
        }
        updateDisplay();
      } else if (e.key === '%') {
        percentage();
      }
    });

    // Element SDK Integration
    async function onConfigChange(config) {
      const titleEl = document.getElementById('calc-title');
      titleEl.textContent = config.calculator_title || defaultConfig.calculator_title;
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ['calculator_title', config.calculator_title || defaultConfig.calculator_title]
      ]);
    }

    // Initialize SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }

    // Initial display
    updateDisplay();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9bce3b1c76d640a5',t:'MTc2ODIzNzQ0Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>